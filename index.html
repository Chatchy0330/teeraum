<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>Teeraum</title>
  <style>
  /* ========================================= */
/* 基本リセットと背景色                    */
/* ========================================= */
html, body {
  margin: 0;
  padding: 0;
  height: 16000px;
  background: transparent;
  overflow-x: hidden;
}

body::before {
  content: "";
  position: absolute;
  top: 1750px;
  left: 0;
  width: 100%;
  height: 13750px;
  background-color: #d7d7d7;
  z-index: 0;
  pointer-events: none;
}

body::after {
  content: "";
  position: absolute;
  top: 15500px;
  left: 0;
  width: 100%;
  height: 10000px;
  background-color: #94967a;
  z-index: 3;
  pointer-events: none;
}

/* タイトルロゴ（右縦） */
#teeraum {
  position: fixed;
  top: 105px;
  right: 1vw;
  writing-mode: sideways-lr;
  text-orientation: sideways;
  font-family: Georgia, 'Times New Roman', Times, serif;
  font-size: clamp(10rem, 25vw, 50rem);
  color: #a0a0a07a;
  z-index: -1;
  line-height: 1.4;
  opacity: 1;
  letter-spacing: 0em;
  pointer-events: none;
}

/* 章番号とテキスト */
#chapter1, #chapter2 {
  position: absolute;
  left: 0;
  background: transparent;
  color: #ffffff;
  font-size: clamp(1rem, 20vh, 30rem);
  text-align: left;
  font-family: Georgia, 'Times New Roman', Times, serif;
  margin-left: 5vh;
  line-height: 1;
}

#chapter1 { top: 1830px; z-index: 1; }
#chapter2 { top: 15580px; z-index: 4; }

#chapter1_text, #chapter2_text {
  position: absolute;
  left: 0;
  background: transparent;
  color: #ffffff;
  font-size: clamp(1rem, 6vh, 20rem);
  text-align: left;
  font-family: Georgia, 'Times New Roman', Times, serif;
  margin-left: 6vh;
  line-height: 1;
}

#chapter1_text { top: 2300px; z-index: 1; }
#chapter2_text { top: 16050px; z-index: 4; }

#chapter2_content {
  position: absolute;
  top: 16100px;
  left: 0;
  width: 100%;
  z-index: 5;
}

/* ========================================= */
/* 目次セクション                            */
/* ========================================= */
#toc {
  background: transparent;
  padding: 20px;
  font-size: 5em;
  line-height: 1.2;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: -2;
  pointer-events: none;
}

#toc .toc-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc .toc-list li {
  display: block;
  margin-bottom: 1rem;
}

#toc .toc-number {
  display: block;
  font-size: clamp(1rem, 13vh, 20rem);
  color: #a0a0a07a;
  text-align: left;
  font-family: Georgia, 'Times New Roman', Times, serif;
  margin-left: 3vh;
  line-height: 0.9;
}

#toc .toc-text {
  display: block;
  font-size: clamp(1rem, 3vh, 5rem);
  color: #222;
  text-align: left;
  font-family: Georgia, 'Times New Roman', Times, serif;
  margin: 3vh 0 0 3.3vh;
  line-height: 0.9;
}

/* ========================================= */
/* スクロールに応じたメッセージ切替         */
/* ========================================= */
#message {
  z-index: 2;
  position: fixed;
  top: 40px;
  left: 0;
  width: 100%;
  box-sizing: border-box;
  color: #000000c9;
  padding-inline: clamp(10px, 10vw, 100px);
  background: transparent;
  pointer-events: none;
}

#message .name {
  width: 100%;
  text-align: left;
  font-weight: 600;
  font-family: Georgia, 'Times New Roman', Times, serif;
  font-size: 5em;
  line-height: 160%;
  margin: 0;
  padding: 0;
}

#message .namejp {
  width: 100%;
  text-align: left;
  font-weight: bold;
  font-family: Georgia, 'Times New Roman', Times, serif;
  font-size: 3.5em;
  margin: 0;
  padding: 0;
}

#message .text {
  font-weight: normal;
  font-family: Georgia, 'Times New Roman', Times, serif;
  text-align: left;
  font-size: 2.7em;
  line-height: 1.1;
  margin-block-start: 0.2em;
  margin-block-end: 5em;
  padding-inline-start: 0.8em;
}

#message .text li {
  margin-bottom: 0.6em;
  line-height: 1.2em;
}

/* ========================================= */
/* 扇アイコン                                */
/* ========================================= */
.fan-container {
  position: fixed;
  bottom: 0;
  left: 0;
  transform-origin: 40% 75%;
  transform: translate(-35%, 22%) rotate(150deg);
  z-index: 1;
  pointer-events: none;
  will-change: transform;
}

.fan-container img {
  width: 100%;
  height: auto;
  display: block;
  opacity: 0.95;
}

/* ========================================= */
/* Chapter 2 - 抽出ステップ (How to Brew)   */
/* ========================================= */
#brew-steps {
  display: flex;
  flex-direction: column;
  gap: 4rem;
  margin: 8vh auto;
  width: 90%;
  max-width: 800px;
}

#brew-steps .step img {
  width: 100%;
  height: auto;
  border-radius: 3px;
}

#brew-steps .step p {
  font-size: 4em; 
  font-weight: normal;
  font-family: Georgia, 'Times New Roman', Times, serif;
  text-align: left;
  line-height: 1.1;
  margin-block-start: 0.2em;
  margin-block-end: 5em;
  padding-inline-start: 0.8em;
}

.step p .tip {
  display: block;
  font-size: 3rem; /* 通常より大きく */
  color: #3b3b3b;
  margin-top: 0.4em;
  line-height: 1.3;
}

/* ========================================= */
/* Brew Methods Card Layout                 */
/* ========================================= */
#brew-methods {
  padding-left: 5vw;
  overflow-x: auto;
}

.scroll-wrapper {
  padding-right: 5vw;
  scroll-padding-left: 5vw;
  display: flex;
  gap: 3vw;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  touch-action: auto; /* ← ここ！縦スクロール有効化 */
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-x: contain;
  overscroll-behavior-y: auto;
  pointer-events: auto;
}

.brew-card {
  flex: 0 0 85vw;
  background: #fff;
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 0 0 10px #ccc;
  scroll-snap-align: start;
  box-sizing: border-box;
}

.brew-card * {
  font-weight: normal;
  font-family: Georgia, 'Times New Roman', Times, serif;
  text-align: left;
  font-size: 1em;
  line-height: 1.3;
  padding-inline-start: 0.8em;
}

.brew-card h2 {
  font-size: 3.5em;
  font-weight: 600;
  padding-inline-start: 0;
  margin: 0 0 0.5em 0;
  display: flex;
  align-items: center;
  gap: 0.5em;
}

.brew-card .tea span {
  font-size: 1em;
  text-align: center;
  padding: 0;
}

.brew-card img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-bottom: 1rem;
  object-fit: contain;
}

.brew-card.hot    { border: 3px solid #d67a6b; }
.brew-card.warm   { border: 3px solid #d6b46b; }
.brew-card.second { border: 3px solid #6bb4d6; }

.brew-title {
  font-size: 2rem;
  display: flex;
  align-items: center;
  gap: 0.7rem;
}

.brew-title img {
  width: 28px;
  height: 28px;
}

.brew-desc {
  margin-top: 1rem;
  font-size: 1rem;
  line-height: 1.5;
}

.brew-info {
  margin-top: 1.5rem;
  font-size: 4em;
}

.brew-info .item {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.brew-info img {
  max-width: 5vw;
  height: auto;
  min-width: 40px;
  max-height: 80px;
  transition: transform 0.3s ease;
}

.ideal-for {
  margin-top: 1.5rem;
}

.tea-pairing {
  display: flex;
  gap: 1.5rem;
  margin-top: 0.5rem;
}

.tea img {
  width: 50px;
  height: 50px;
  border-radius: 50%;
}

.tea span {
  display: block;
  text-align: center;
  font-size: 0.85rem;
  margin-top: 0.4rem;
}

#chapter3, #chapter3_text {
  position: absolute;
  left: 0;
  color: #ffffff;
  font-size: clamp(1rem, 20vh, 30rem);
  margin-left: 5vh;
  line-height: 1;
}
#chapter3 { top: 25000px; z-index: 5; }
#chapter3_text { top: 25400px; font-size: clamp(1rem, 6vh, 20rem); margin-left: 6vh; z-index: 5; }

#chapter3_content {
  position: absolute;
  top: 25800px;
  left: 0;
  width: 100%;
  z-index: 5;
  padding: 5vh 10vw 20vh;
  box-sizing: border-box;
}

#history-events .event {
  margin-bottom: 40vh;
  font-size: 2.2rem;
  color: #222;
  background: #fff;
  padding: 2rem;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}


#timeline-image-wrapper {
  width: 100%;
  overflow: hidden;
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  background-color: #fff;
  z-index: 6;
}
#timeline-marker {
  position: fixed;
  bottom: 500px; /* 画像の上に重ねるように調整（必要に応じて調整） */
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-top: 30px solid black;
  z-index: 7;
  display: none;
}

#timeline-image {
  width: 2300px; /* 表示サイズ = 実サイズ3000px の半分 */
  height: auto;
  display: block;
  transition: transform 0.6s ease;
}

  </style>
</head>

<body>

  <div id="teeraum">Teeraum</div>

  <!-- ── HTML：目次セクション ── -->
  <section id="toc">
    <ol class="toc-list">

      <li>
        <span class="toc-number">1.</span>
        <span class="toc-text">Types of Tea</span>
      </li>
      <li>
        <span class="toc-number">2.</span>
        <span class="toc-text">How to Brew</span>
      </li>
      <li>
        <span class="toc-number">3.</span>
        <span class="toc-text">Health Benefits</span>
      </li>
      <li>
        <span class="toc-number">4.</span>
        <span class="toc-text">History of Japanese Tea</span>
      </li>
    </ol>
  </section>

  <div id="chapter1">1.</div>
  <div id="chapter1_text">Types of Tea</div>

  <!-- ② メッセージ -->
  <div id="message"></div>

  <!-- ③ スクロール量表示 -->
  <div id="scrollValue">0px</div>

  <!-- ④ 扇アイコン -->
  <div class="fan-container" id="fan">
    <img src="img/ogi.png" alt="扇">
  </div>

  <div id="chapter2">2.</div>
  <div id="chapter2_text">How to Brew</div>

  <!-- Chapter 2: Brewing Steps -->
   <div id="chapter2_content">
  <section id="brew-steps">
    <div class="step">
  <img src="img/step1.png" alt="Step 1">
  <p>
    Cook water to the desired tempature.
    <span class="tip">The water temperature drops by approximately 10℃ when poured into a non-prewarmed cup or Kyusu. For example, to achieve 80°C water in your Kyusu, first pour boiling water into cups, then transfer it to the Kyusu. </span>
  </p>
</div>
<div class="step">
  <img src="img/step2.png" alt="Step 2">
  <p>
    Add tea leaves into a Kyusu (or teapod), and then pour in hot water. 
    <span class="tip">See right for the recommended amount.
In general, soft water works better for Japanese teas. You can find it at supermarkets. </span>
  </p>
</div>
<div class="step">
  <img src="img/step3.png" alt="Step 3">
  <p>Wait for the specified time.
    <span class="tip">See right for the recommended brewing time. 
You can either close the lid or leave it open to enjoy the dance of the tea leaves.</span>
  </p>
</div>
<div class="step">
  <img src="img/step4.png" alt="Step 4">
  <p>
    Pour tea into (pre-heated) cups. 
    <span class="tip">Pour a small amount into the first cup, then the second, then the third. Next, pour in reverse order — third, second, first — and repeat. This method is called ‘Mawashitsugi’</span>
  </p>
</div>
  </section>

  <!-- Chapter 2: Brew Types -->
  <section id="brew-methods">
    <div class="scroll-wrapper">

      <!-- Warm Brew -->
      <div class="brew-card warm">
        <h2 class="brew-title"><img src="img/icon-temp-warm.png"> Warm Brew</h2>
        <p class="brew-desc">Warm brew is gentle and brings out umami. Recommended for delicate green teas.</p>
        <div class="brew-info">
          <div class="item"><img src="img/icon-temp-warm.png"><span>60 - 70℃</span></div>
          <div class="item"><img src="img/icon-beaker-warm.png"><span>5g of tea leaves in 200 mL of water</span></div>
          <div class="item"><img src="img/icon-timer-warm.png"><span>60 - 90s</span></div>
        </div>
        <div class="ideal-for">
          <p>Ideal for:</p>
          <div class="tea-pairing">
            <div class="tea"><img src="img/gyokuro.png"><span>GYOKURO</span></div>
            <div class="tea"><img src="img/sencha.png"><span>SENCHA</span></div>
          </div>
        </div>
      </div>

      <!-- Hot Brew -->
      <div class="brew-card hot">
        <h2 class="brew-title"><img src="img/icon-temp-hot.png"> Hot Brew</h2>
        <p class="brew-desc">A quick, strong brew with boiling water. More bitterness and less umami. Good for aromatic
          teas.</p>
        <div class="brew-info">
          <div class="item"><img src="img/icon-temp-hot.png"><span>90 - 100℃</span></div>
          <div class="item"><img src="img/icon-beaker-hot.png"><span>5g of tea leaves in 200 mL of water</span></div>
          <div class="item"><img src="img/icon-timer-hot.png"><span>20 - 30s</span></div>
        </div>
        <div class="ideal-for">
          <p>Ideal for:</p>
          <div class="tea-pairing">
            <div class="tea"><img src="img/hojicha.png"><span>HOJICHA</span></div>
            <div class="tea"><img src="img/genmaicha.png"><span>GENMAICHA</span></div>
          </div>
        </div>
      </div>

      <!-- Second Brew -->
      <div class="brew-card second">
        <h2 class="brew-title"><img src="img/icon-temp-second.png"> Second Brew</h2>
        <p class="brew-desc">Second brew uses already steeped leaves, requiring shorter brew time. Adjust temperature
          slightly higher.</p>
        <div class="brew-info">
          <div class="item"><img src="img/icon-temp-second.png"><span>70 - 80℃</span></div>
          <div class="item"><img src="img/icon-beaker-second.png"><span>5g of used tea leaves in 200 mL of water</span>
          </div>
          <div class="item"><img src="img/icon-timer-second.png"><span>10 - 20s</span></div>
        </div>
        <div class="ideal-for">
          <p>Ideal for:</p>
          <div class="tea-pairing">
            <div class="tea"><img src="img/sencha.png"><span>SENCHA</span></div>
            <div class="tea"><img src="img/gyokuro.png"><span>GYOKURO</span></div>
          </div>
        </div>
      </div>

    </div>
  </section>
  </div>
  <div id="chapter3">3.</div>
<div id="chapter3_text">History of Japanese Tea</div>
<div id="chapter3_content">
  <section id="history-events">
    <div class="event" data-year="804">
      <h2>804年：最澄が茶を持ち帰る</h2>
      <p>唐から茶の種と喫茶の習慣を日本へ。</p>
    </div>
    <div class="event" data-year="1191">
      <h2>1191年：栄西『喫茶養生記』を著す</h2>
      <p>茶の効能を紹介し、武士層に広まる契機に。</p>
    </div>
    <div class="event" data-year="1577">
      <h2>1577年：千利休 茶道を大成</h2>
      <p>わび茶の精神が確立され、茶の湯文化が深まる。</p>
    </div>
    <div class="event" data-year="1738">
      <h2>1738年：永谷宗円が煎茶製法を確立</h2>
      <p>現代日本茶の原型が誕生。</p>
    </div>
    <div class="event" data-year="2020">
      <h2>2020年：日本茶カフェ文化の広がり</h2>
      <p>抹茶やボトリングティーが世界で人気に。</p>
    </div>
  </section>
  <div id="timeline-marker"></div>
  <div id="timeline-image-wrapper">
  <img id="timeline-image" src="img/timeline.png" alt="Timeline">
</div>
</div>

  <script>
    const toc = document.getElementById('toc');
    const fan = document.getElementById('fan');
    const message = document.getElementById('message');
    const scrollValue = document.getElementById('scrollValue');

    const initialTransform = 'translate(-35%, 22%) rotate(150deg)';

    // メッセージ＆閾値(px)
    const messages = [
      "", // 初期表示用（空）
      '<span class="name">KAMAIRICHA</span><br><span class="namejp"> 釜炒り茶</span><ul class="text"><li>lorem</li><li>ipsim</li></ul>',
      '<span class="name">SENCHA</span><span class="namejp"> 煎茶</span><ul class="text"><li>Most common green tea in Japan.</li><li>Tea leaves are steamed after harvesting to prevent fermentation, resulting in the bright green colour. </li><li>Offers a delicate harmony of sweetness and astringency. </li></ul>',
      '<span class="name">MATCHA</span><span class="namejp"> 抹茶</span><ul class="text"><li>Finely ground powder from high-quality, schade-grown green tea leaves.</li><li>Whisked with hot water, not brewed like other teas. </li><li>Whisked with hot water, not brewed like other teas. </li></ul>',
      '<span class="name">HOJICHA</span><span class="namejp"> 焙じ茶</span><ul class="text"><li>Roasted green tea with a toasty aroma.</li><li>Low in caffeine, making it gentle on the stomach.</li><li>Budget-friendly and easy to prepare. </li></ul>',
      '<span class="name">GENMAICHA</span><span class="namejp"> 玄米茶</span><ul class="text"><li>A blend of green tea and roasted brown rice.</li><li>Has a toasty and savory flavor with a mild astringency from the green tea base.</li><li>Also known as “popcorn tea” due to popped rice grains. </li></ul>',
      '<span class="name">OOLONG TEA</span><span class="namejp"> 烏龍茶</span><ul class="text"><li> Semi-oxidized tea, halfway between green and black tea.</li><li>Moderate caffeine level and digestive benefits.</li><li>Common in Chinese and Taiwanese tea culture.</li></ul>',
      '<span class="name">BLACK TEA</span><span class="namejp"> 紅茶</span><ul class="text"><li>Fully oxidized tea with a dark color and strong taste.</li><li>Higher caffeine content than green or oolong tea.</li><li>Also produced in Japan (called Wakocha), althogh not (yet) widely known. </li></ul>',
      "" // 終端用（空）
    ];
    const messageThresholds = [0, 3000, 4564, 6102, 7500, 9100, 10500, 12000, 15293];

    // 速度段階設定
    const divisor = 5400;
    const breakpoints = [3, 700, 900, 1000];
    const speeds = [1.0, 0.7, 0.5, 0.2];
    const invScales = speeds.map(s => s / divisor);

    // 回転・スライド定数
    const initialDeg = 150;
    const maxRotation = 390;
    const shiftThreshold = 0.6;
    const oneMinusShiftThresh = 1 - shiftThreshold;
    const maxShiftX = 300;
    const maxShiftY = 200;

    let latestScrollY = 0;
    let ticking = false;

    window.addEventListener('scroll', () => {
      // 1) 最新の scrollY を取得
      latestScrollY = window.scrollY;
      // 2) 画面右上に表示
      scrollValue.textContent = `${latestScrollY}px`;
      // 3) アニメーション更新
      if (!ticking) {
        requestAnimationFrame(update);
        ticking = true;
      }
    }, { passive: true });

    function update() {
      // 目次パララックス効果：スクロール量の 0.5 倍だけ下へ
      const tocParallaxOffset = latestScrollY * 0.5;
      toc.style.transform = `translateY(${tocParallaxOffset}px)`;
      document.getElementById('teeraum').style.transform = `translateY(${tocParallaxOffset}px)`;
      // 実スクロール量（TOC も含む）
      const scrollOffset = latestScrollY;

      // 3px 未満なら動かさない
      if (scrollOffset < breakpoints[0]) {
        fan.style.transform = initialTransform;
        message.textContent = messages[0];
        ticking = false;
        return;
      }

      // メッセージ切り替え
      let idx = 0;
      for (let i = messageThresholds.length - 1; i >= 0; i--) {
        if (scrollOffset >= messageThresholds[i]) {
          idx = i; break;
        }
      }
      message.innerHTML = messages[idx];

      // 進捗を区間ごとに積算
      let progress;
      if (scrollOffset <= breakpoints[1]) {
        progress = scrollOffset * invScales[0];
      } else if (scrollOffset <= breakpoints[2]) {
        const base = breakpoints[1] * invScales[0];
        progress = base + (scrollOffset - breakpoints[1]) * invScales[1];
      } else if (scrollOffset <= breakpoints[3]) {
        const base = breakpoints[1] * invScales[0]
          + (breakpoints[2] - breakpoints[1]) * invScales[1];
        progress = base + (scrollOffset - breakpoints[2]) * invScales[2];
      } else {
        const base = breakpoints[1] * invScales[0]
          + (breakpoints[2] - breakpoints[1]) * invScales[1]
          + (breakpoints[3] - breakpoints[2]) * invScales[2];
        progress = base + (scrollOffset - breakpoints[3]) * invScales[3];
      }
      progress = Math.min(Math.max(progress, 0), 1);

      // 回転角度
      const rotateDeg = progress * maxRotation;

      // 左下スライド
      let shiftX = 0, shiftY = 0;
      if (progress > shiftThreshold) {
        const t2 = (progress - shiftThreshold) / oneMinusShiftThresh;
        shiftX = t2 * maxShiftX;
        shiftY = t2 * maxShiftY;
      }

      // 適用
      fan.style.transform =
        `translate(-35%, 22%) ` +
        `translateX(${-shiftX}px) ` +
        `translateY(${shiftY}px) ` +
        `rotate(${initialDeg - rotateDeg}deg)`;

      ticking = false;
    }

    // サイズ調整（必要時のみ）
    function adjustFanSize() {
      const vw = window.innerWidth, vh = window.innerHeight;
      const baseSize = Math.max(vw * 1.1, vh * 1.1);
      fan.style.width = `${baseSize}px`;
      fan.style.height = 'auto';
    }
    adjustFanSize();
    let lastWidth = window.innerWidth;
    window.addEventListener('orientationchange', () => {
      adjustFanSize();
      lastWidth = window.innerWidth;
    });
    window.addEventListener('resize', () => {
      const w = window.innerWidth;
      if (w !== lastWidth) {
        adjustFanSize();
        lastWidth = w;
      }
    });

    // Chapter 3 - IntersectionObserver for year tracking

    // --- 年号表示を Chapter 3 のみ表示する ---
const chapter3Content = document.getElementById('chapter3_content');


window.addEventListener('scroll', toggleTimelineVisibility);
const historyEvents = document.querySelectorAll('#history-events .event');




// Chapter 3 の表示位置を Chapter 2 の直後に配置する
function positionChapter3() {
  const chapter2 = document.getElementById('chapter2_content');
  const chapter3 = document.getElementById('chapter3');
  const chapter3Text = document.getElementById('chapter3_text');
  const chapter3Content = document.getElementById('chapter3_content');

  const bottom2 = chapter2.offsetTop + chapter2.offsetHeight;

  chapter3.style.top = `${bottom2 + 200}px`;
  chapter3Text.style.top = `${bottom2 + 600}px`;
  chapter3Content.style.top = `${bottom2 + 1000}px`;
}

window.addEventListener('load', positionChapter3);
window.addEventListener('resize', positionChapter3);


// === Chapter 3 タイムライン画像処理 ===
const timelineWrapper = document.getElementById('timeline-image-wrapper');
const timelineImage = document.getElementById('timeline-image');


window.addEventListener('load', toggleTimelineVisibility);
// Chapter 3 が見えているかどうかで画像表示切替
function toggleTimelineVisibility() {
  const rect = chapter3Content.getBoundingClientRect();
  const inView = rect.top < window.innerHeight && rect.bottom > 0;
  timelineWrapper.style.display = inView ? 'block' : 'none';
    document.getElementById('timeline-marker').style.display = inView ? 'block' : 'none';
}
window.addEventListener('scroll', toggleTimelineVisibility);

// 800年 = 500px, 2000年 = 2500px → 1700年ぶんで2000px
const yearToX = year => {
  const pxPerYear = 2000 / (2000 - 800); // 約1.6667px/年
  return 500 + (year - 800) * pxPerYear;
};

// 年号に対応する位置を中央にスライド
function centerTimelineOn(year) {
  const x = yearToX(parseInt(year));
  const containerWidth = timelineWrapper.offsetWidth;
  const imgDisplayWidth = timelineImage.offsetWidth;
  const maxOffset = imgDisplayWidth - containerWidth;
  const targetX = x - containerWidth / 2;
  const offsetX = Math.max(0, Math.min(targetX, maxOffset));
  timelineImage.style.transform = `translateX(${-offsetX}px)`;
}

// IntersectionObserver（更新）
const updatedYearObserver = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const year = entry.target.dataset.year;
      centerTimelineOn(year);
    }
  });
}, {
  root: null,
  rootMargin: '-33% 0px -66% 0px',
  threshold: 0.0
});
historyEvents.forEach(event => updatedYearObserver.observe(event));
  </script>

</body>

</html>